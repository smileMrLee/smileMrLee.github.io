<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>数据库分库分表sharding-jdbc实践 - 大世界，小人物</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">大世界，小人物</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">smileMrLee</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">学习ing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/ElasticSearch%206%20%E5%AD%A6%E4%B9%A0/" class="dropdown-item">ElasticSearch 6 学习</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/TiDB%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="dropdown-item">TiDB 学习笔记</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/Vue.js%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="dropdown-item">Vue.js学习笔记</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/docker%20%E5%AE%9E%E6%88%98/" class="dropdown-item">Docker 实战</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/java%E8%B0%83%E4%BC%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="dropdown-item">Java调优学习笔记</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/k8s%E5%B7%A5%E5%85%B7kt-connect%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="dropdown-item">K8s工具kt connect学习笔记</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/kafka%E5%AD%A6%E4%B9%A0/" class="dropdown-item">kafka学习</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/mongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="dropdown-item">mongoDB学习笔记</a>
</li>
                                    
<li>
    <a href="../../%E5%AD%A6%E4%B9%A0ing/%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" class="dropdown-item">个人学习计划</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">实践 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../docker%20%E7%8E%AF%E5%A2%83%E4%B8%8BmongoDB%20%E8%BF%81%E7%A7%BB%E4%B9%8B%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D%E5%AE%9E%E6%88%98/" class="dropdown-item">docker 环境下mongoDB 迁移之备份和恢复实战</a>
</li>
                                    
<li>
    <a href="../mac%20%E4%BD%BF%E7%94%A8charles%E6%8A%93%E5%8C%85%E6%8C%87%E5%8D%97/" class="dropdown-item">Mac 使用charles抓包指南</a>
</li>
                                    
<li>
    <a href="../%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E5%AE%9ASpring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6/" class="dropdown-item">一文彻底搞定Spring事务传播机制</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">数据库分库分表sharding-jdbc实践</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">总结 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../%E6%80%BB%E7%BB%93/dubbo%20%E6%9C%8D%E5%8A%A1%E6%AD%A3%E5%B8%B8%E6%B3%A8%E5%86%8C%E5%92%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E4%BD%86%E8%B0%83%E7%94%A8%E6%8A%A5%E9%94%99No%20provider/" class="dropdown-item">dubbo 服务正常注册和消费，但调用报错No provider</a>
</li>
                                    
<li>
    <a href="../../%E6%80%BB%E7%BB%93/spring%20boot%E5%BA%94%E7%94%A8%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%EF%BC%8C%E4%B9%9F%E6%B2%A1%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF/" class="dropdown-item">spring boot应用无法启动，也没报错信息</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">推荐 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../%E6%8E%A8%E8%8D%90/%E8%AF%A6%E8%A7%A3Twitter%20snowflake%E5%BC%80%E6%BA%90%E5%88%86%E5%B8%83%E5%BC%8F%E8%87%AA%E5%A2%9EID%E7%AE%97%E6%B3%95%EF%BC%8C%E9%99%84%E6%BC%94%E7%AE%97%E9%AA%8C%E8%AF%81%E8%BF%87%E7%A8%8B/" class="dropdown-item">详解Twitter snowflake开源分布式自增ID算法，附演算验证过程</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E5%AE%9ASpring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../%E6%80%BB%E7%BB%93/dubbo%20%E6%9C%8D%E5%8A%A1%E6%AD%A3%E5%B8%B8%E6%B3%A8%E5%86%8C%E5%92%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E4%BD%86%E8%B0%83%E7%94%A8%E6%8A%A5%E9%94%99No%20provider/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#sharding-jdbc" class="nav-link">数据库分库分表sharding-jdbc实践</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">开始前必读</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#github" class="nav-link">github开源地址</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_2" class="nav-link">实战</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-pomsharding-jdbc-mybatis" class="nav-link">1. pom依赖引入sharding-jdbc 及 mybatis组件包</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2" class="nav-link">2. 配置数据源</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3-databasetable" class="nav-link">3. 配置数据库database分库策略、表table分表策略</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#4" class="nav-link">4. 编码实现</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#5-http" class="nav-link">5. http调用验证</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="sharding-jdbc">数据库分库分表sharding-jdbc实践</h1>
<h1 id="_1">开始前必读</h1>
<h2 id="github">github开源地址</h2>
<p>https://github.com/smileMrLee/sharding-jdbc-demo</p>
<p>本项目基于 spring boot + sharding-jdbc + mybatis + mysql搭建，用作测试验证sharding-jdbc 实现数据库分库分表。
下载启动本项目前，请先执行DDL.sql 初始化数据库。</p>
<ul>
<li>
<p>DDL.sql 文件位于本项目根路径下。</p>
</li>
<li>
<p>启动前，请先修改 mysql 连接信息，确保连接账号密码无误。</p>
</li>
</ul>
<h1 id="_2">实战</h1>
<p>集成sharding-jdbc总共需要以下几步</p>
<h2 id="1-pomsharding-jdbc-mybatis">1. pom依赖引入sharding-jdbc 及 mybatis组件包</h2>
<pre><code class="xml">    &lt;!-- mysql driver --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- mybatis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- sharding-jdbc start --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;
            &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;
            &lt;artifactId&gt;sharding-jdbc-spring-namespace&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- sharding-jdbc end --&gt;
</code></pre>

<h2 id="2">2. 配置数据源</h2>
<pre><code class="properties"># test0数据源
sharding.jdbc.datasource.test0.type=com.zaxxer.hikari.HikariDataSource
sharding.jdbc.datasource.test0.driver-class-name=com.mysql.cj.jdbc.Driver
sharding.jdbc.datasource.test0.jdbc-url=jdbc:mysql://127.0.0.1:3306/test0?useUnicode=true&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC
sharding.jdbc.datasource.test0.username=root
sharding.jdbc.datasource.test0.password=123456

…… 

# testn数据源
sharding.jdbc.datasource.test${n}.type=com.zaxxer.hikari.HikariDataSource
sharding.jdbc.datasource.test${n}.driver-class-name=com.mysql.cj.jdbc.Driver
sharding.jdbc.datasource.test${n}.jdbc-url=jdbc:mysql://127.0.0.1:3306/test${n}?useUnicode=true&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC
sharding.jdbc.datasource.test${n}.username=root
sharding.jdbc.datasource.test${n}.password=123456

# 注意此处的&quot;test0&quot; 到 &quot;test${n}&quot; 按照实际需要配置分库需要的数据源个数。 ${n} 改为实际的库编号。 
# 虽然此处的test${n} 中的n不是必须填写数字，但是为了保持好的规范，我们强烈建议按照阿拉伯数字1~n对数据库进行编码。

</code></pre>

<h2 id="3-databasetable">3. 配置数据库database分库策略、表table分表策略</h2>
<pre><code class="properties"># 分库策略
# 水平拆分的数据库（表） 配置分库，分库主要取决于id列
sharding.jdbc.config.sharding.default-database-strategy.inline.sharding-column=id
sharding.jdbc.config.sharding.default-database-strategy.inline.algorithm-expression=test$-&gt;{id % 3}
</code></pre>

<pre><code class="properties"># 分表策略 
# 其中car为逻辑表 分表主要取决于count列，⚠️此处应该选择一个均匀分布的列值，本项目为了简便才随机选择count列。
sharding.jdbc.config.sharding.tables.t_car.actual-data-nodes=test$-&gt;{0..2}.t_car_$-&gt;{0..1}
sharding.jdbc.config.sharding.tables.t_car.table-strategy.inline.sharding-column=count
</code></pre>

<h2 id="4">4. 编码实现</h2>
<ul>
<li>
<p>详细参考源码，entity 中表名使用逻辑表表名。
@TableName("t_car")</p>
</li>
<li>
<p>在启动类添加注解
@MapperScan("com.lee.sharding.jdbc.demo.mapper")</p>
</li>
</ul>
<p>然后编写service 和 controller进行crud</p>
<h2 id="5-http">5. http调用验证</h2>
<p>保存车辆信息：http://localhost:8080/car/save<br />
   查询车辆列表：http://localhost:8080/car/get</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
